version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - npm install --production
  pre_build:
    commands:
      - echo Configure AWS CLI...
      - aws configure set aws_access_key_id $AWS_CREDENTIALS_ACCESS_KEY
      - aws configure set aws_secret_access_key $AWS_CREDENTIALS_SECRET_KEY
      - aws configure set default.region $AWS_DEFAULT_REGION
      - aws configure set default.max_payload_size 104857600
      - sam --version
      - echo Verify and update handler
      - ./scripts/lambda-handler.sh
  build:
    commands:
      - npm run build
  post_build:
    commands:
      - ./scripts/lambda-package.sh